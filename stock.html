<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Stock - Automotora</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
    <style>
        /* ... (estilos previos) ... */
    </style>
</head>
<body>
    <div id="loginForm">
        <h2>Ingrese la contraseña</h2>
        <input type="password" id="password" placeholder="Contraseña">
        <button onclick="login()">Ingresar</button>
        <button onclick="cambiarContrasena()">Cambiar Contraseña</button>
    </div>

    <div id="mainContent" class="hidden">
        <!-- ... (contenido principal previo) ... -->
    </div>

    <script>
        // Función para generar un salt aleatorio
        function generateSalt() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        // Función para hashear la contraseña con un salt
        function hashPassword(password, salt) {
            return sha256(password + salt);
        }

        // Inicialización: si no hay contraseña almacenada, crear una por defecto
        if (!localStorage.getItem('passwordHash')) {
            const defaultPassword = "contraseña123";
            const salt = generateSalt();
            const hash = hashPassword(defaultPassword, salt);
            localStorage.setItem('passwordHash', hash);
            localStorage.setItem('salt', salt);
        }

        function login() {
            const password = document.getElementById('password').value;
            const storedHash = localStorage.getItem('passwordHash');
            const salt = localStorage.getItem('salt');
            const inputHash = hashPassword(password, salt);

            if (inputHash === storedHash) {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                initializeApp();
            } else {
                alert("Contraseña incorrecta. Intente de nuevo.");
            }
        }

        function cambiarContrasena() {
            const currentPassword = prompt("Ingrese la contraseña actual:");
            const storedHash = localStorage.getItem('passwordHash');
            const salt = localStorage.getItem('salt');
            const currentHash = hashPassword(currentPassword, salt);

            if (currentHash === storedHash) {
                const newPassword = prompt("Ingrese la nueva contraseña:");
                const confirmPassword = prompt("Confirme la nueva contraseña:");

                if (newPassword === confirmPassword) {
                    const newSalt = generateSalt();
                    const newHash = hashPassword(newPassword, newSalt);
                    localStorage.setItem('passwordHash', newHash);
                    localStorage.setItem('salt', newSalt);
                    alert("Contraseña cambiada exitosamente.");
                } else {
                    alert("Las contraseñas no coinciden. Intente de nuevo.");
                }
            } else {
                alert("Contraseña actual incorrecta. Intente de nuevo.");
            }
        }

        function initializeApp() {
            // ... (código de inicialización previo) ...
        }

        // ... (resto del código de la aplicación) ...
    </script>
</body>
</html>
