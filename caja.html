<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programa de Caja</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #333;
        }
        .container {
            max-width: 800px;
            width: 100%;
        }
        .section {
            margin-bottom: 20px;
        }
        #productList {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        #receiptContent {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        #receiptContent h3 {
            margin-top: 0;
        }
        .num-button {
            width: 40px;
            height: 40px;
            margin: 5px;
            background-color: #eee;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            line-height: 40px;
            cursor: pointer;
            font-size: 18px;
        }
        #numPad {
            display: flex;
            flex-wrap: wrap;
            width: 200px;
            margin-top: 20px;
        }
        #numPad .num-button {
            flex: 1 0 33%;
        }
        #numPad #clear, #numPad #enter {
            flex: 1 0 100%;
        }
        #productSelect, #manualProductName, #manualProductQuantity, #manualProductPrice, #priceExcel, #quantity {
            margin-bottom: 10px;
            padding: 8px;
            width: 100%;
            box-sizing: border-box;
        }
        #manualProductPrice, #priceExcel {
            text-align: right;
        }
        #printReceipt {
            display: none;
        }
    </style>
</head>
<body>

<h1>Programa de Caja</h1>
<div class="container">

    <!-- Sección de carga y selección de productos -->
    <div class="section">
        <h2>Cargar Productos desde Excel</h2>
        <input type="file" id="fileInput" />
        <input type="text" id="productFilter" placeholder="Buscar producto..." />
        <select id="product" size="5"></select>
        <input type="text" id="priceExcel" placeholder="Precio" />
        <input type="number" id="quantity" placeholder="Cantidad" />
        <button id="addProductFromExcel">Agregar Producto desde Excel</button>
    </div>

    <!-- Sección de productos manuales -->
    <div class="section">
        <h2>Agregar Producto Manual</h2>
        <input type="text" id="manualProductName" placeholder="Nombre del Producto" />
        <input type="number" id="manualProductQuantity" placeholder="Cantidad" />
        <input type="text" id="manualProductPrice" placeholder="Precio" />
        <button id="addManualProduct">Agregar Producto Manual</button>
    </div>

    <!-- Sección del teclado numérico -->
    <div class="section">
        <h2>Teclado Numérico</h2>
        <div id="numPad">
            <div class="num-button" data-number="1">1</div>
            <div class="num-button" data-number="2">2</div>
            <div class="num-button" data-number="3">3</div>
            <div class="num-button" data-number="4">4</div>
            <div class="num-button" data-number="5">5</div>
            <div class="num-button" data-number="6">6</div>
            <div class="num-button" data-number="7">7</div>
            <div class="num-button" data-number="8">8</div>
            <div class="num-button" data-number="9">9</div>
            <div class="num-button" data-number="0">0</div>
            <div class="num-button" id="clear">C</div>
            <div class="num-button" id="enter">Enter</div>
        </div>
    </div>

    <!-- Sección de la lista de productos -->
    <div class="section">
        <h2>Lista de Productos</h2>
        <div id="productList"></div>
        <h3>Total: $<span id="receiptTotal">0.00</span></h3>
    </div>

    <!-- Botones para generar e imprimir boleta -->
    <div class="section">
        <button id="generateReceipt">Generar Boleta</button>
        <button id="printReceipt">Imprimir Boleta</button>
    </div>

    <!-- Contenido de la boleta -->
    <div id="receiptContent">
        <h3>Emporio Temuco</h3>
        <p>Avenida San Martín 01745, Temuco</p>
        <p>Tel: +56951589539</p>
        <p>Email: contacto@emporiovaldivianoko.cl</p>
        <p>Web: emporiovaldivianoko.cl</p>
        <h4>Productos:</h4>
        <ul id="receiptItems"></ul>
        <h3>Total: $<span id="receiptTotalReceipt">0.00</span></h3>
        <p>&copy; 2024 Emporio Temuco</p>
    </div>

</div>

<script>
    let productsFromExcel = [];
    let cart = [];
    let currentInput = '';

    // Leer el archivo Excel
    document.getElementById('fileInput').addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = e.target.result;
                const workbook = XLSX.read(data, { type: 'binary' });
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const range = XLSX.utils.decode_range(sheet['!ref']);
                productsFromExcel = [];
                for (let row = 1; row <= range.e.r; row++) { // Empezar en 1 para omitir la fila de encabezado
                    const cell = sheet[XLSX.utils.encode_cell({ r: row, c: 1 })]; // Segunda columna
                    if (cell) {
                        productsFromExcel.push({ name: cell.v });
                    }
                }
                updateProductSelect(productsFromExcel);
            };
            reader.readAsBinaryString(file);
        }
    });

    // Actualizar opciones de productos
    function updateProductSelect(products) {
        const productSelect = document.getElementById('product');
        productSelect.innerHTML = '';
        products.forEach(product => {
            const option = document.createElement('option');
            option.value = product.name;
            option.textContent = product.name;
            productSelect.appendChild(option);
        });
    }

    // Filtrar productos por palabra clave
    document.getElementById('productFilter').addEventListener('input', (event) => {
        const searchQuery = event.target.value.toLowerCase();
        const filteredProducts = productsFromExcel.filter(product => 
            product.name.toLowerCase().includes(searchQuery)
        );
        updateProductSelect(filteredProducts);
    });

    // Agregar producto del Excel a la lista
    document.getElementById('addProductFromExcel').addEventListener('click', () => {
        const selectedProduct = document.getElementById('product').value;
        const price = parseFloat(document.getElementById('priceExcel').value);
        const quantity = parseInt(document.getElementById('quantity').value, 10);

        if (!selectedProduct || isNaN(price) || isNaN(quantity) || quantity <= 0) {
            alert('Por favor, complete todos los campos.');
            return;
        }

        const product = productsFromExcel.find(p => p.name === selectedProduct);
        if (product) {
            cart.push({ name: product.name, price: price, quantity: quantity });
            updateCart();
        }

        document.getElementById('priceExcel').value = '';
        document.getElementById('quantity').value = '';
    });

    // Agregar producto manual a la lista
    document.getElementById('addManualProduct').addEventListener('click', () => {
        const name = document.getElementById('manualProductName').value;
        const quantity = parseInt(document.getElementById('manualProductQuantity').value, 10);
        const price = parseFloat(document.getElementById('manualProductPrice').value);

        if (!name || isNaN(quantity) || isNaN(price) || quantity <= 0) {
            alert('Por favor, complete todos los campos.');
            return;
        }

        cart.push({ name, price, quantity });
        updateCart();

        document.getElementById('manualProductName').value = '';
        document

.getElementById('manualProductQuantity').value = '';
        document.getElementById('manualProductPrice').value = '';
    });

    // Actualizar la lista de productos en el carrito
    function updateCart() {
        const productList = document.getElementById('productList');
        const receiptItems = document.getElementById('receiptItems');
        let total = 0;

        productList.innerHTML = '';
        receiptItems.innerHTML = '';

        cart.forEach(item => {
            const listItem = document.createElement('div');
            listItem.textContent = `${item.name} - Cantidad: ${item.quantity} - Precio: $${item.price.toFixed(2)}`;
            productList.appendChild(listItem);

            const receiptItem = document.createElement('li');
            receiptItem.textContent = `${item.name} - Cantidad: ${item.quantity} - Precio: $${item.price.toFixed(2)} - Total: $${(item.price * item.quantity).toFixed(2)}`;
            receiptItems.appendChild(receiptItem);

            total += item.price * item.quantity;
        });

        document.getElementById('receiptTotal').textContent = total.toFixed(2);
        document.getElementById('receiptTotalReceipt').textContent = total.toFixed(2);
    }

    // Generar boleta
    document.getElementById('generateReceipt').addEventListener('click', () => {
        if (cart.length === 0) {
            alert('No hay productos en la lista.');
            return;
        }

        document.getElementById('receiptContent').style.display = 'block';
        document.getElementById('printReceipt').style.display = 'inline';

        // Limpiar la lista para la próxima venta
        cart = [];
        updateCart();
    });

    // Imprimir boleta
    document.getElementById('printReceipt').addEventListener('click', () => {
        window.print();
        document.getElementById('receiptContent').style.display = 'none';
        document.getElementById('printReceipt').style.display = 'none';
    });

    // Manejo del teclado numérico
    document.querySelectorAll('#numPad .num-button').forEach(button => {
        button.addEventListener('click', () => {
            const number = button.getAttribute('data-number');
            if (number !== undefined) {
                currentInput += number;
                updatePriceField();
            } else if (button.id === 'clear') {
                currentInput = '';
                updatePriceField();
            } else if (button.id === 'enter') {
                const price = parseFloat(currentInput);
                if (!isNaN(price) && price > 0) {
                    if (document.getElementById('manualProductName').value) {
                        document.getElementById('manualProductPrice').value = price.toFixed(2);
                        document.getElementById('manualProductQuantity').focus();
                    } else {
                        document.getElementById('priceExcel').value = price.toFixed(2);
                    }
                }
                currentInput = '';
                updatePriceField();
            }
        });
    });

    // Actualizar el campo de precio del teclado numérico
    function updatePriceField() {
        if (document.getElementById('manualProductName').value) {
            document.getElementById('manualProductPrice').value = currentInput;
        } else {
            document.getElementById('priceExcel').value = currentInput;
        }
    }

    // Sincronizar el teclado numérico con el teclado físico
    document.addEventListener('keydown', (event) => {
        const num = event.key;
        if (!isNaN(num) && num !== ' ' && num !== '.') {
            currentInput += num;
            updatePriceField();
        } else if (event.key === 'Enter') {
            const price = parseFloat(currentInput);
            if (!isNaN(price) && price > 0) {
                if (document.getElementById('manualProductName').value) {
                    document.getElementById('manualProductPrice').value = price.toFixed(2);
                    document.getElementById('manualProductQuantity').focus();
                } else {
                    document.getElementById('priceExcel').value = price.toFixed(2);
                }
                currentInput = '';
                updatePriceField();
            }
        } else if (event.key === 'Escape') {
            currentInput = '';
            updatePriceField();
        }
    });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</body>
</html>
