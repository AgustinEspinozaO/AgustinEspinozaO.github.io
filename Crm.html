<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoCRM Pro v4</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #f0f0f0;
            --text-color: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .menu-icon {
            font-size: 24px;
            cursor: pointer;
        }

        .sidebar {
            position: fixed;
            left: -250px;
            top: 0;
            width: 250px;
            height: 100%;
            background-color: white;
            transition: 0.3s;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1001;
            overflow-y: auto;
            padding-top: 60px;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li a {
            display: block;
            padding: 15px;
            color: var(--text-color);
            text-decoration: none;
            border-bottom: 1px solid #eee;
        }

        .main-content {
            padding: 20px;
            margin-top: 60px;
        }

        .logout-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--primary-color);
            color: white;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                left: -100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <span class="menu-icon" onclick="toggleSidebar()">‚ò∞</span>
        <h1>AutoCRM Pro</h1>
    </div>

    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="#" onclick="showSection('dashboard')">üìä Dashboard</a></li>
            <li><a href="#" onclick="showSection('inventory')">üöó Inventario</a></li>
            <li><a href="#" onclick="showSection('clients')">üë• Clientes</a></li>
            <li><a href="#" onclick="showSection('sales')">üí∞ Ventas</a></li>
            <li><a href="#" onclick="showSection('services')">üîß Servicios</a></li>
            <li><a href="#" onclick="showSection('pipelines')">üìà Pipelines</a></li>
            <li><a href="#" onclick="showSection('employees')">üë®‚Äçüíº Empleados</a></li>
            <li><a href="#" onclick="showSection('tags')">üè∑Ô∏è Etiquetas</a></li>
        </ul>
        <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
    </div>

    <div class="main-content" id="main-content">
        <!-- El contenido principal se cargar√° aqu√≠ din√°micamente -->
    </div>

    <script>
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Funci√≥n para alternar la visibilidad del sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Funci√≥n para mostrar diferentes secciones
        function showSection(section) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `<h2>${section.charAt(0).toUpperCase() + section.slice(1)}</h2>`;
            
            switch(section) {
                case 'dashboard':
                    showDashboard();
                    break;
                case 'inventory':
                    showInventory();
                    break;
                case 'clients':
                    showClients();
                    break;
                case 'sales':
                    showSales();
                    break;
                case 'services':
                    showServices();
                    break;
                case 'pipelines':
                    showPipelines();
                    break;
                case 'employees':
                    showEmployees();
                    break;
                case 'tags':
                    showTags();
                    break;
            }

            toggleSidebar();
        }

        // Funci√≥n para mostrar el dashboard
        async function showDashboard() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML += `
                <div class="card">
                    <h3>Resumen de Ventas</h3>
                    <canvas id="salesChart"></canvas>
                </div>
                <div class="card">
                    <h3>Clientes Nuevos</h3>
                    <canvas id="clientsChart"></canvas>
                </div>
            `;

            try {
                const salesData = await getSalesData();
                const clientsData = await getClientsData();

                createChart('salesChart', 'Ventas Mensuales', salesData);
                createChart('clientsChart', 'Nuevos Clientes', clientsData);
            } catch (error) {
                console.error("Error al cargar datos del dashboard:", error);
                mainContent.innerHTML += `<p>Error al cargar los datos. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para crear gr√°ficos
        function createChart(canvasId, label, data) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Funci√≥n para mostrar el inventario
        async function showInventory() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML += `
                <div class="card">
                    <h3>Inventario de Veh√≠culos</h3>
                    <button class="btn" onclick="showAddVehicleForm()">Agregar Veh√≠culo</button>
                    <table id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Marca</th>
                                <th>Modelo</th>
                                <th>A√±o</th>
                                <th>Precio</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const inventory = await getInventoryData();
                const tableBody = document.querySelector('#inventoryTable tbody');
                tableBody.innerHTML = ''; // Limpiar la tabla antes de agregar nuevos datos
                inventory.forEach(car => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${car.brand}</td>
                        <td>${car.model}</td>
                        <td>${car.year}</td>
                        <td>$${car.price.toLocaleString()}</td>
                        <td>
                            <button onclick="editVehicle('${car.id}')">Editar</button>
                            <button onclick="deleteVehicle('${car.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar el inventario:", error);
                mainContent.innerHTML += `<p>Error al cargar el inventario. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para mostrar el formulario de agregar veh√≠culo
        function showAddVehicleForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Agregar Veh√≠culo</h3>
                    <form id="addVehicleForm">
                        <div class="form-group">
                            <label for="brand">Marca:</label>
                            <input type="text" id="brand" required>
                        </div>
                        <div class="form-group">
                            <label for="model">Modelo:</label>
                            <input type="text" id="model" required>
                        </div>
                        <div class="form-group">
                            <label for="year">A√±o:</label>
                            <input type="number" id="year" required>
                        </div>
                        <div class="form-group">
                            <label for="price">Precio:</label>
                            <input type="number" id="price" required>
                        </div>
                        <button type="submit" class="btn">Agregar Veh√≠culo</button>
                    </form>
                </div>
            `;

            document.getElementById('addVehicleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const vehicleData = {
                    brand: document.getElementById('brand').value,
                    model: document.getElementById('model').value,
                    year: parseInt(document.getElementById('year').value),
                    price: parseFloat(document.getElementById('price').value)
                };
                try {
                    await addVehicle(vehicleData);
                    alert('Veh√≠culo agregado con √©xito');
                    showInventory();
                } catch (error) {
                    console.error("Error al agregar veh√≠culo:", error);
                    alert('Error al agregar veh√≠culo. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para editar veh√≠culo
        async function editVehicle(id) {
            try {
                const vehicle = await getVehicleById(id);
                showEditVehicleForm(vehicle);
            } catch (error) {
                console.error("Error al obtener datos del veh√≠culo:", error);
                alert('Error al cargar los datos del veh√≠culo. Por favor, int√©ntelo de nuevo.');
            }
        }

        // Funci√≥n para mostrar el formulario de edici√≥n de veh√≠culo
        function showEditVehicleForm(vehicle) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Editar Veh√≠culo</h3>
                    <form id="editVehicleForm">
                        <input type="hidden" id="vehicleId" value="${vehicle.id}">
                        <div class="form-group">
                            <label for="brand">Marca:</label>
                            <input type="text" id="brand" value="${vehicle.brand}" required>
                        </div>
                        <div class="form-group">
                            <label for="model">Modelo:</label>
                            <input type="text" id="model" value="${vehicle.model}" required>
                        </div>
                        <div class="form-group">
                            <label for="year">A√±o:</label>
                            <input type="number" id="year" value="${vehicle.year}" required>
                        </div>
                        <div class="form-group">
                            <label for="price">Precio:</label>
                            <input type="number" id="price" value="${vehicle.price}" required>
                        </div>
                        <button type="submit" class="btn">Actualizar Veh√≠culo</button>
                    </form>
                </div>
            `;

            document.getElementById('editVehicleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const updatedVehicleData = {
                    id: document.getElementById('vehicleId').value,
                    brand: document.getElementById('brand').value,
                    model: document.getElementById('model').value,
                    year: parseInt(document.getElementById('year').value),
                    price: parseFloat(document.getElementById('price').value)
                };
                try {
                    await updateVehicle(updatedVehicleData);
                    alert('Veh√≠culo actualizado con √©xito');
                    showInventory();
                } catch (error) {
                    console.error("Error al actualizar veh√≠culo:", error);
                    alert('Error al actualizar el veh√≠culo. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para eliminar veh√≠culo
        async function deleteVehicle(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar este veh√≠culo?')) {
                try {
                    await removeVehicle(id);
                    alert('Veh√≠culo eliminado con √©xito');
                    showInventory();
                } catch (error) {
                    console.error("Error al eliminar veh√≠culo:", error);
                    alert('Error al eliminar el veh√≠culo. Por favor, int√©ntelo de nuevo.');
                }
            }
        }

        // Funci√≥n para mostrar clientes
        async function showClients() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Clientes</h3>
                    <button class="btn" onclick="showAddClientForm()">Agregar Cliente</button>
                    <table id="clientsTable">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Tel√©fono</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const clients = await getClientsData();
                const tableBody = document.querySelector('#clientsTable tbody');
                tableBody.innerHTML = '';
                clients.forEach(client => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${client.name}</td>
                        <td>${client.email}</td>
                        <td>${client.phone}</td>
                        <td>
                            <button onclick="editClient('${client.id}')">Editar</button>
                            <button onclick="deleteClient('${client.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar clientes:", error);
                mainContent.innerHTML += `<p>Error al cargar los clientes. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para mostrar el formulario de agregar cliente
        function showAddClientForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Agregar Cliente</h3>
                    <form id="addClientForm">
                        <div class="form-group">
                            <label for="name">Nombre:</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Tel√©fono:</label>
                            <input type="tel" id="phone" required>
                        </div>
                        <button type="submit" class="btn">Agregar Cliente</button>
                    </form>
                </div>
            `;

            document.getElementById('addClientForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const clientData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                };
                try {
                    await addClient(clientData);
                    alert('Cliente agregado con √©xito');
                    showClients();
                } catch (error) {
                    console.error("Error al agregar cliente:", error);
                    alert('Error al agregar cliente. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para editar cliente
        async function editClient(id) {
            try {
                const client = await getClientById(id);
                showEditClientForm(client);
            } catch (error) {
                console.error("Error al obtener datos del cliente:", error);
                alert('Error al cargar los datos del cliente. Por favor, int√©ntelo de nuevo.');
            }
        }

        // Funci√≥n para mostrar el formulario de edici√≥n de cliente
        function showEditClientForm(client) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Editar Cliente</h3>
                    <form id="editClientForm">
                        <input type="hidden" id="clientId" value="${client.id}">
                        <div class="form-group">
                            <label for="name">Nombre:</label>
                            <input type="text" id="name" value="${client.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" value="${client.email}" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Tel√©fono:</label>
                            <input type="tel" id="phone" value="${client.phone}" required>
                        </div>
                        <button type="submit" class="btn">Actualizar Cliente</button>
                    </form>
                </div>
            `;

            document.getElementById('editClientForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const updatedClientData = {
                    id: document.getElementById('clientId').value,
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                };
                try {
                    await updateClient(updatedClientData);
                    alert('Cliente actualizado con √©xito');
                    showClients();
                } catch (error) {
                    console.error("Error al actualizar cliente:", error);
                    alert('Error al actualizar el cliente. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para eliminar cliente
        async function deleteClient(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar este cliente?')) {
                try {
                    await removeClient(id);
                    alert('Cliente eliminado con √©xito');
                    showClients();
                } catch (error) {
                    console.error("Error al eliminar cliente:", error);
                    alert('Error al eliminar el cliente. Por favor, int√©ntelo de nuevo.');
                }
            }
        }

        // Funci√≥n para mostrar ventas
        async function showSales() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Ventas</h3>
                    <button class="btn" onclick="showAddSaleForm()">Registrar Venta</button>
                    <table id="salesTable">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Cliente</th>
                                <th>Veh√≠culo</th>
                                <th>Monto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const sales = await getSalesDetailedData();
                const tableBody = document.querySelector('#salesTable tbody');
                tableBody.innerHTML = '';
                sales.forEach(sale => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${new Date(sale.date).toLocaleDateString()}</td>
                        <td>${sale.clientName}</td>
                        <td>${sale.vehicleName}</td>
                        <td>$${sale.amount.toLocaleString()}</td>
                        <td>
                            <button onclick="editSale('${sale.id}')">Editar</button>
                            <button onclick="deleteSale('${sale.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar ventas:", error);
                mainContent.innerHTML += `<p>Error al cargar las ventas. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para mostrar el formulario de agregar venta
        function showAddSaleForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Registrar Nueva Venta</h3>
                    <form id="addSaleForm">
                        <div class="form-group">
                            <label for="clientId">Cliente:</label>
                            <select id="clientId" required>
                                <option value="">Seleccione un cliente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleId">Veh√≠culo:</label>
                            <select id="vehicleId" required>
                                <option value="">Seleccione un veh√≠culo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">Monto:</label>
                            <input type="number" id="amount" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="date">Fecha:</label>
                            <input type="date" id="date" required>
                        </div>
                        <button type="submit" class="btn">Registrar Venta</button>
                    </form>
                </div>
            `;

            loadClientsIntoSelect();
            loadVehiclesIntoSelect();

            document.getElementById('addSaleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const saleData = {
                    clientId: document.getElementById('clientId').value,
                    vehicleId: document.getElementById('vehicleId').value,
                    amount: parseFloat(document.getElementById('amount').value),
                    date: document.getElementById('date').value
                };
                try {
                    await addSale(saleData);
                    alert('Venta registrada con √©xito');
                    showSales();
                } catch (error) {
                    console.error("Error al registrar venta:", error);
                    alert('Error al registrar la venta. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para editar venta
        async function editSale(id) {
            try {
                const sale = await getSaleById(id);
                showEditSaleForm(sale);
            } catch (error) {
                console.error("Error al obtener datos de la venta:", error);
                alert('Error al cargar los datos de la venta. Por favor, int√©ntelo de nuevo.');
            }
        }

        // Funci√≥n para mostrar el formulario de edici√≥n de venta
        function showEditSaleForm(sale) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Editar Venta</h3>
                    <form id="editSaleForm">
                        <input type="hidden" id="saleId" value="${sale.id}">
                        <div class="form-group">
                            <label for="clientId">Cliente:</label>
                            <select id="clientId" required>
                                <option value="">Seleccione un cliente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleId">Veh√≠culo:</label>
                            <select id="vehicleId" required>
                                <option value="">Seleccione un veh√≠culo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">Monto:</label>
                            <input type="number" id="amount" value="${sale.amount}" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="date">Fecha:</label>
                            <input type="date" id="date" value="${sale.date}" required>
                        </div>
                        <button type="submit" class="btn">Actualizar Venta</button>
                    </form>
                </div>
            `;

            loadClientsIntoSelect(sale.clientId);
            loadVehiclesIntoSelect(sale.vehicleId);

            document.getElementById('editSaleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const updatedSaleData = {
                    id: document.getElementById('saleId').value,
                    clientId: document.getElementById('clientId').value,
                    vehicleId: document.getElementById('vehicleId').value,
                    amount: parseFloat(document.getElementById('amount').value),
                    date: document.getElementById('date').value
                };
                try {
                    await updateSale(updatedSaleData);
                    alert('Venta actualizada con √©xito');
                    showSales();
                } catch (error) {
                    console.error("Error al actualizar venta:", error);
                    alert('Error al actualizar la venta. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para eliminar venta
        async function deleteSale(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar esta venta?')) {
                try {
                    await removeSale(id);
                    alert('Venta eliminada con √©xito');
                    showSales();
                } catch (error) {
                    console.error("Error al eliminar venta:", error);
                    alert('Error al eliminar la venta. Por favor, int√©ntelo de nuevo.');
                }
            }
        }

        // Funci√≥n para mostrar servicios
        async function showServices() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Servicios</h3>
                    <button class="btn" onclick="showAddServiceForm()">Programar Servicio</button>
                    <table id="servicesTable">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Cliente</th>
                                <th>Veh√≠culo</th>
                                <th>Tipo de Servicio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const services = await getServicesData();
                const tableBody = document.querySelector('#servicesTable tbody');
                tableBody.innerHTML = '';
                services.forEach(service => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${new Date(service.date).toLocaleDateString()}</td>
                        <td>${service.clientName}</td>
                        <td>${service.vehicleName}</td>
                        <td>${service.serviceType}</td>
                        <td>${service.status}</td>
                        <td>
                            <button onclick="editService('${service.id}')">Editar</button>
                            <button onclick="deleteService('${service.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar servicios:", error);
                mainContent.innerHTML += `<p>Error al cargar los servicios. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para mostrar el formulario de agregar servicio
        function showAddServiceForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Programar Nuevo Servicio</h3>
                    <form id="addServiceForm">
                        <div class="form-group">
                            <label for="clientId">Cliente:</label>
                            <select id="clientId" required>
                                <option value="">Seleccione un cliente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleId">Veh√≠culo:</label>
                            <select id="vehicleId" required>
                                <option value="">Seleccione un veh√≠culo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="serviceType">Tipo de Servicio:</label>
                            <input type="text" id="serviceType" required>
                        </div>
                        <div class="form-group">
                            <label for="date">Fecha:</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label for="status">Estado:</label>
                            <select id="status" required>
                                <option value="Programado">Programado</option>
                                <option value="En Progreso">En Progreso</option>
                                <option value="Completado">Completado</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">Programar Servicio</button>
                    </form>
                </div>
            `;

            loadClientsIntoSelect();
            loadVehiclesIntoSelect();

            document.getElementById('addServiceForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const serviceData = {
                    clientId: document.getElementById('clientId').value,
                    vehicleId: document.getElementById('vehicleId').value,
                    serviceType: document.getElementById('serviceType').value,
                    date: document.getElementById('date').value,
                    status: document.getElementById('status').value
                };
                try {
                    await addService(serviceData);
                    alert('Servicio programado con √©xito');
                    showServices();
                } catch (error) {
                    console.error("Error al programar servicio:", error);
                    alert('Error al programar el servicio. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para editar servicio
        async function editService(id) {
            try {
                const service = await getServiceById(id);
                showEditServiceForm(service);
            } catch (error) {
                console.error("Error al obtener datos del servicio:", error);
                alert('Error al cargar los datos del servicio. Por favor, int√©ntelo de nuevo.');
            }
        }

        // Funci√≥n para mostrar el formulario de edici√≥n de servicio
        function showEditServiceForm(service) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Editar Servicio</h3>
                    <form id="editServiceForm">
                        <input type="hidden" id="serviceId" value="${service.id}">
                        <div class="form-group">
                            <label for="clientId">Cliente:</label>
                            <select id="clientId" required>
                                <option value="">Seleccione un cliente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleId">Veh√≠culo:</label>
                            <select id="vehicleId" required>
                                <option value="">Seleccione un veh√≠culo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="serviceType">Tipo de Servicio:</label>
                            <input type="text" id="serviceType" value="${service.serviceType}" required>
                        </div>
                        <div class="form-group">
                            <label for="date">Fecha:</label>
                            <input type="date" id="date" value="${service.date}" required>
                        </div>
                        <div class="form-group">
                            <label for="status">Estado:</label>
                            <select id="status" required>
                                <option value="Programado" ${service.status === 'Programado' ? 'selected' : ''}>Programado</option>
                                <option value="En Progreso" ${service.status === 'En Progreso' ? 'selected' : ''}>En Progreso</option>
                                <option value="Completado" ${service.status === 'Completado' ? 'selected' : ''}>Completado</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">Actualizar Servicio</button>
                    </form>
                </div>
            `;

            loadClientsIntoSelect(service.clientId);
            loadVehiclesIntoSelect(service.vehicleId);

            document.getElementById('editServiceForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const updatedServiceData = {
                    id: document.getElementById('serviceId').value,
                    clientId: document.getElementById('clientId').value,
                    vehicleId: document.getElementById('vehicleId').value,
                    serviceType: document.getElementById('serviceType').value,
                    date: document.getElementById('date').value,
                    status: document.getElementById('status').value
                };
                try {
                    await updateService(updatedServiceData);
                    alert('Servicio actualizado con √©xito');
                    showServices();
                } catch (error) {
                    console.error("Error al actualizar servicio:", error);
                    alert('Error al actualizar el servicio. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funci√≥n para eliminar servicio
        async function deleteService(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar este servicio?')) {
                try {
                    await removeService(id);
                    alert('Servicio eliminado con √©xito');
                    showServices();
                } catch (error) {
                    console.error("Error al eliminar servicio:", error);
                    alert('Error al eliminar el servicio. Por favor, int√©ntelo de nuevo.');
                }
            }
        }

        // Funciones auxiliares para cargar datos en selectores
        async function loadClientsIntoSelect(selectedClientId = '') {
            try {
                const clients = await getClientsData();
                const select = document.getElementById('clientId');
                select.innerHTML = '<option value="">Seleccione un cliente</option>';
                clients.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id;
                    option.textContent = client.name;
                    if (client.id === selectedClientId) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            } catch (error) {
                console.error("Error al cargar clientes:", error);
                alert('Error al cargar la lista de clientes. Por favor, recargue la p√°gina.');
            }
        }

        async function loadVehiclesIntoSelect(selectedVehicleId = '') {
            try {
                const vehicles = await getInventoryData();
                const select = document.getElementById('vehicleId');
                select.innerHTML = '<option value="">Seleccione un veh√≠culo</option>';
                vehicles.forEach(vehicle => {
                    const option = document.createElement('option');
                    option.value = vehicle.id;
                    option.textContent = `${vehicle.brand} ${vehicle.model} (${vehicle.year})`;
                    if (vehicle.id === selectedVehicleId) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            } catch (error) {
                console.error("Error al cargar veh√≠culos:", error);
                alert('Error al cargar la lista de veh√≠culos. Por favor, recargue la p√°gina.');
            }
        }

        // Funciones de interacci√≥n con la base de datos (simuladas para este ejemplo)
        async function addVehicle(vehicleData) {
            // Simular agregar veh√≠culo a la base de datos
            console.log("Veh√≠culo agregado:", vehicleData);
            // En una implementaci√≥n real, aqu√≠ se agregar√≠a el veh√≠culo a Firebase
        }

        async function updateVehicle(vehicleData) {
            // Simular actualizar veh√≠culo en la base de datos
            console.log("Veh√≠culo actualizado:", vehicleData);
            // En una implementaci√≥n real, aqu√≠ se actualizar√≠a el veh√≠culo en Firebase
        }

        async function removeVehicle(id) {
            // Simular eliminar veh√≠culo de la base de datos
            console.log("Veh√≠culo eliminado:", id);
            // En una implementaci√≥n real, aqu√≠ se eliminar√≠a el veh√≠culo de Firebase
        }

        async function addClient(clientData) {
            // Simular agregar cliente a la base de datos
            console.log("Cliente agregado:", clientData);
            // En una implementaci√≥n real, aqu√≠ se agregar√≠a el cliente a Firebase
        }

        async function updateClient(clientData) {
            // Simular actualizar cliente en la base de datos
            console.log("Cliente actualizado:", clientData);
            // En una implementaci√≥n real, aqu√≠ se actualizar√≠a el cliente en Firebase
        }

        async function removeClient(id) {
            // Simular eliminar cliente de la base de datos
            console.log("Cliente eliminado:", id);
            // En una implementaci√≥n real, aqu√≠ se eliminar√≠a el cliente de Firebase
        }

        async function addSale(saleData) {
            // Simular agregar venta a la base de datos
            console.log("Venta agregada:", saleData);
            // En una implementaci√≥n real, aqu√≠ se agregar√≠a la venta a Firebase
        }

        async function updateSale(saleData) {
            // Simular actualizar venta en la base de datos
            console.log("Venta actualizada:", saleData);
            // En una implementaci√≥n real, aqu√≠ se actualizar√≠a la venta en Firebase
        }

        async function removeSale(id) {
            // Simular eliminar venta de la base de datos
            console.log("Venta eliminada:", id);
            // En una implementaci√≥n real, aqu√≠ se eliminar√≠a la venta de Firebase
        }

        async function addService(serviceData) {
            // Simular agregar servicio a la base de datos
            console.log("Servicio agregado:", serviceData);
            // En una implementaci√≥n real, aqu√≠ se agregar√≠a el servicio a Firebase
        }

        async function updateService(serviceData) {
            // Simular actualizar servicio en la base de datos
            console.log("Servicio actualizado:", serviceData);
            // En una implementaci√≥n real, aqu√≠ se actualizar√≠a el servicio en Firebase
        }

        async function removeService(id) {
            // Simular eliminar servicio de la base de datos
            console.log("Servicio eliminado:", id);
            // En una implementaci√≥n real, aqu√≠ se eliminar√≠a el servicio de Firebase
        }

        // Funciones para obtener datos (simuladas para este ejemplo)
        async function getSalesData() {
            // Simular obtenci√≥n de datos de ventas
            return [10000, 15000, 13000, 17000, 20000, 18000];
        }

        async function getClientsData() {
            // Simular obtenci√≥n de datos de clientes
            return [
                { id: '1', name: 'Juan P√©rez', email: 'juan@example.com', phone: '123-456-7890' },
                { id: '2', name: 'Mar√≠a Garc√≠a', email: 'maria@example.com', phone: '098-765-4321' }
            ];
        }

        async function getInventoryData() {
            // Simular obtenci√≥n de datos de inventario
            return [
                { id: '1', brand: 'Toyota', model: 'Corolla', year: 2022, price: 25000 },
                { id: '2', brand: 'Honda', model: 'Civic', year: 2021, price: 23000 },
                { id: '3', brand: 'Ford', model: 'Mustang', year: 2023, price: 45000 }
            ];
        }

        async function getSalesDetailedData() {
            // Simular obtenci√≥n de datos detallados de ventas
            return [
                { id: '1', date: '2023-08-01', clientName: 'Juan P√©rez', vehicleName: 'Toyota Corolla', amount: 25000 },
                { id: '2', date: '2023-08-15', clientName: 'Mar√≠a Garc√≠a', vehicleName: 'Honda Civic', amount: 23000 }
            ];
        }

        async function getServicesData() {
            // Simular obtenci√≥n de datos de servicios
            return [
                { id: '1', date: '2023-08-10', clientName: 'Juan P√©rez', vehicleName: 'Toyota Corolla', serviceType: 'Mantenimiento', status: 'Completado' },
                { id: '2', date: '2023-08-20', clientName: 'Mar√≠a Garc√≠a', vehicleName: 'Honda Civic', serviceType: 'Reparaci√≥n', status: 'En Progreso' }
            ];
        }

        async function getVehicleById(id) {
            // Simular obtenci√≥n de un veh√≠culo por ID
            const vehicles = await getInventoryData();
            return vehicles.find(vehicle => vehicle.id === id);
        }

        async function getClientById(id) {
            // Simular obtenci√≥n de un cliente por ID
            const clients = await getClientsData();
            return clients.find(client => client.id === id);
        }

        async function getSaleById(id) {
            // Simular obtenci√≥n de una venta por ID
            const sales = await getSalesDetailedData();
            return sales.find(sale => sale.id === id);
        }

        async function getServiceById(id) {
            // Simular obtenci√≥n de un servicio por ID
            const services = await getServicesData();
            return services.find(service => service.id === id);
        }

        // ... (c√≥digo anterior sin cambios)

        // Funci√≥n para mostrar pipelines
        async function showPipelines() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Pipelines de Ventas</h3>
                    <button class="btn" onclick="showAddPipelineForm()">Agregar Pipeline</button>
                    <div id="pipelinesContainer"></div>
                </div>
            `;

            try {
                const pipelines = await getPipelinesData();
                const pipelinesContainer = document.getElementById('pipelinesContainer');
                pipelines.forEach(pipeline => {
                    const pipelineElement = document.createElement('div');
                    pipelineElement.className = 'pipeline';
                    pipelineElement.innerHTML = `
                        <h4>${pipeline.name}</h4>
                        <div class="pipeline-stages">
                            ${pipeline.stages.map(stage => `
                                <div class="pipeline-stage">
                                    <h5>${stage.name}</h5>
                                    <ul>
                                        ${stage.opportunities.map(opp => `
                                            <li>${opp.name} - $${opp.value}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="editPipeline('${pipeline.id}')">Editar</button>
                        <button onclick="deletePipeline('${pipeline.id}')">Eliminar</button>
                    `;
                    pipelinesContainer.appendChild(pipelineElement);
                });
            } catch (error) {
                console.error("Error al cargar pipelines:", error);
                mainContent.innerHTML += `<p>Error al cargar los pipelines. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        function showAddPipelineForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Agregar Nuevo Pipeline</h3>
                    <form id="addPipelineForm">
                        <div class="form-group">
                            <label for="pipelineName">Nombre del Pipeline:</label>
                            <input type="text" id="pipelineName" required>
                        </div>
                        <div id="stagesContainer">
                            <h4>Etapas</h4>
                        </div>
                        <button type="button" onclick="addStageField()">Agregar Etapa</button>
                        <button type="submit" class="btn">Crear Pipeline</button>
                    </form>
                </div>
            `;

            addStageField(); // Agregar al menos una etapa por defecto

            document.getElementById('addPipelineForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const pipelineData = {
                    name: document.getElementById('pipelineName').value,
                    stages: Array.from(document.querySelectorAll('.stage-field')).map(stage => ({
                        name: stage.querySelector('input').value,
                        opportunities: []
                    }))
                };
                try {
                    await addPipeline(pipelineData);
                    alert('Pipeline creado con √©xito');
                    showPipelines();
                } catch (error) {
                    console.error("Error al crear pipeline:", error);
                    alert('Error al crear el pipeline. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        function addStageField() {
            const stagesContainer = document.getElementById('stagesContainer');
            const stageField = document.createElement('div');
            stageField.className = 'form-group stage-field';
            stageField.innerHTML = `
                <label for="stageName">Nombre de la Etapa:</label>
                <input type="text" name="stageName" required>
                <button type="button" onclick="this.parentElement.remove()">Eliminar Etapa</button>
            `;
            stagesContainer.appendChild(stageField);
        }

        async function editPipeline(id) {
            try {
                const pipeline = await getPipelineById(id);
                showEditPipelineForm(pipeline);
            } catch (error) {
                console.error("Error al obtener datos del pipeline:", error);
                alert('Error al cargar los datos del pipeline. Por favor, int√©ntelo de nuevo.');
            }
        }

        function showEditPipelineForm(pipeline) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Editar Pipeline</h3>
                    <form id="editPipelineForm">
                        <input type="hidden" id="pipelineId" value="${pipeline.id}">
                        <div class="form-group">
                            <label for="pipelineName">Nombre del Pipeline:</label>
                            <input type="text" id="pipelineName" value="${pipeline.name}" required>
                        </div>
                        <div id="stagesContainer">
                            <h4>Etapas</h4>
                            ${pipeline.stages.map((stage, index) => `
                                <div class="form-group stage-field">
                                    <label for="stageName${index}">Nombre de la Etapa:</label>
                                    <input type="text" name="stageName" id="stageName${index}" value="${stage.name}" required>
                                    <button type="button" onclick="this.parentElement.remove()">Eliminar Etapa</button>
                                </div>
                            `).join('')}
                        </div>
                        <button type="button" onclick="addStageField()">Agregar Etapa</button>
                        <button type="submit" class="btn">Actualizar Pipeline</button>
                    </form>
                </div>
            `;

            document.getElementById('editPipelineForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const updatedPipelineData = {
                    id: document.getElementById('pipelineId').value,
                    name: document.getElementById('pipelineName').value,
                    stages: Array.from(document.querySelectorAll('.stage-field')).map(stage => ({
                        name: stage.querySelector('input').value,
                        opportunities: []
                    }))
                };
                try {
                    await updatePipeline(updatedPipelineData);
                    alert('Pipeline actualizado con √©xito');
                    showPipelines();
                } catch (error) {
                    console.error("Error al actualizar pipeline:", error);
                    alert('Error al actualizar el pipeline. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        async function deletePipeline(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar este pipeline?')) {
                try {
                    await removePipeline(id);
                    alert('Pipeline eliminado con √©xito');
                    showPipelines();
                } catch (error) {
                    console.error("Error al eliminar pipeline:", error);
                    alert('Error al eliminar el pipeline. Por favor, int√©ntelo de nuevo.');
                }
            }
        }

        // Funci√≥n para mostrar empleados
        async function showEmployees() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Gesti√≥n de Empleados</h3>
                    <button class="btn" onclick="showAddEmployeeForm()">Agregar Empleado</button>
                    <table id="employeesTable">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Cargo</th>
                                <th>Email</th>
                                <th>Tel√©fono</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const employees = await getEmployeesData();
                const tableBody = document.querySelector('#employeesTable tbody');
                tableBody.innerHTML = '';
                employees.forEach(employee => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${employee.name}</td>
                        <td>${employee.position}</td>
                        <td>${employee.email}</td>
                        <td>${employee.phone}</td>
                        <td>
                            <button onclick="editEmployee('${employee.id}')">Editar</button>
                            <button onclick="deleteEmployee('${employee.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar empleados:", error);
                mainContent.innerHTML += `<p>Error al cargar los empleados. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        function showAddEmployeeForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Agregar Empleado</h3>
                    <form id="addEmployeeForm">
                        <div class="form-group">
                            <label for="name">Nombre:</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label for="position">Cargo:</label>
                            <input type="text" id="position" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Tel√©fono:</label>
                            <input type="tel" id="phone" required>
                        </div>
                        <button type="submit" class="btn">Agregar Empleado</button>
                    </form>
                </div>
            `;

            document.getElementById('addEmployeeForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const employeeData = {
                    name: document.getElementById('name').value,
                    position: document.getElementById('position').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                };
                try {
                    await addEmployee(employeeData);
                    alert('Empleado agregado con √©xito');
                    showEmployees();
                } catch (error) {
                    console.error("Error al agregar empleado:", error);
                    alert('Error al agregar empleado. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        async function editEmployee(id) {
            try {
                const employee = await getEmployeeById(id);
                showEditEmployeeForm(employee);
            } catch (error) {
                console.error("Error al obtener datos del empleado:", error);
                alert('Error al cargar los datos del empleado. Por favor, int√©ntelo de nuevo.');
            }
        }

        function showEditEmployeeForm(employee) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Editar Empleado</h3>
                    <form id="editEmployeeForm">
                        <input type="hidden" id="employeeId" value="${employee.id}">
                        <div class="form-group">
                            <label for="name">Nombre:</label>
                            <input type="text" id="name" value="${employee.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="position">Cargo:</label>
                            <input type="text" id="position" value="${employee.position}" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" value="${employee.email}" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Tel√©fono:</label>
                            <input type="tel" id="phone" value="${employee.phone}" required>
                        </div>
                        <button type="submit" class="btn">Actualizar Empleado</button>
                    </form>
                </div>
            `;

            document.getElementById('editEmployeeForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const updatedEmployeeData = {
                    id: document.getElementById('employeeId').value,
                    name: document.getElementById('name').value,
                    position: document.getElementById('position').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                };
                try {
                    await updateEmployee(updatedEmployeeData);
                    alert('Empleado actualizado con √©xito');
                    showEmployees();
                } catch (error) {
                    console.error("Error al actualizar empleado:", error);
                    alert('Error al actualizar el empleado. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        async function deleteEmployee(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar este empleado?')) {
                try {
                    await removeEmployee(id);
                    alert('Empleado eliminado con √©xito');
                    showEmployees();
                } catch (error) {
                    console.error("Error al eliminar empleado:", error);
                    alert('Error al eliminar el empleado. Por favor, int√©ntelo de nuevo.');
                }
            }
        }

        // Funci√≥n para mostrar etiquetas
        async function showTags() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Gesti√≥n de Etiquetas</h3>
                    <button class="btn" onclick="showAddTagForm()">Agregar Etiqueta</button>
                    <div id="tagsContainer"></div>
                </div>
            `;

            try {
                const tags = await getTagsData();
                const tagsContainer = document.getElementById('tagsContainer');
                tagsContainer.innerHTML = '';
                tags.forEach(tag => {
                    const tagElement = document.createElement('div');
                    tagElement.className = 'tag';
                    tagElement.style.backgroundColor = tag.color;
                    tagElement.innerHTML = `
                        ${tag.name}
                        <button onclick="editTag('${tag.id}')">Editar</button>
                        <button onclick="deleteTag('${tag.id}')">Eliminar</button>
                    `;
                    tagsContainer.appendChild(tagElement);
                });
            } catch (error) {
                console.error("Error al cargar etiquetas:", error);
                    mainContent.innerHTML += `<p>Error al cargar las etiquetas. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        function showAddTagForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Agregar Etiqueta</h3>
                    <form id="addTagForm">
                        <div class="form-group">
                            <label for="tagName">Nombre de la Etiqueta:</label>
                            <input type="text" id="tagName" required>
                        </div>
                        <div class="form-group">
                            <label for="tagColor">Color:</label>
                            <input type="color" id="tagColor" required>
                        </div>
                        <button type="submit" class="btn">Agregar Etiqueta</button>
                    </form>
                </div>
            `;

            document.getElementById('addTagForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const tagData = {
                    name: document.getElementById('tagName').value,
                    color: document.getElementById('tagColor').value
                };
                try {
                    await addTag(tagData);
                    alert('Etiqueta agregada con √©xito');
                    showTags();
                } catch (error) {
                    console.error("Error al agregar etiqueta:", error);
                    alert('Error al agregar etiqueta. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        async function editTag(id) {
            try {
                const tag = await getTagById(id);
                showEditTagForm(tag);
            } catch (error) {
                console.error("Error al obtener datos de la etiqueta:", error);
                alert('Error al cargar los datos de la etiqueta. Por favor, int√©ntelo de nuevo.');
            }
        }

        function showEditTagForm(tag) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Editar Etiqueta</h3>
                    <form id="editTagForm">
                        <input type="hidden" id="tagId" value="${tag.id}">
                        <div class="form-group">
                            <label for="tagName">Nombre de la Etiqueta:</label>
                            <input type="text" id="tagName" value="${tag.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="tagColor">Color:</label>
                            <input type="color" id="tagColor" value="${tag.color}" required>
                        </div>
                        <button type="submit" class="btn">Actualizar Etiqueta</button>
                    </form>
                </div>
            `;

            document.getElementById('editTagForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const updatedTagData = {
                    id: document.getElementById('tagId').value,
                    name: document.getElementById('tagName').value,
                    color: document.getElementById('tagColor').value
                };
                try {
                    await updateTag(updatedTagData);
                    alert('Etiqueta actualizada con √©xito');
                    showTags();
                } catch (error) {
                    console.error("Error al actualizar etiqueta:", error);
                    alert('Error al actualizar la etiqueta. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        async function deleteTag(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar esta etiqueta?')) {
                try {
                    await removeTag(id);
                    alert('Etiqueta eliminada con √©xito');
                    showTags();
                } catch (error) {
                    console.error("Error al eliminar etiqueta:", error);
                    alert('Error al eliminar la etiqueta. Por favor, int√©ntelo de nuevo.');
                }
            }
        }

        // Funciones de interacci√≥n con la base de datos para pipelines
        async function addPipeline(pipelineData) {
            try {
                await db.collection('pipelines').add(pipelineData);
            } catch (error) {
                console.error("Error al agregar pipeline:", error);
                throw error;
            }
        }

        async function updatePipeline(pipelineData) {
            try {
                await db.collection('pipelines').doc(pipelineData.id).update(pipelineData);
            } catch (error) {
                console.error("Error al actualizar pipeline:", error);
                throw error;
            }
        }

        async function removePipeline(id) {
            try {
                await db.collection('pipelines').doc(id).delete();
            } catch (error) {
                console.error("Error al eliminar pipeline:", error);
                throw error;
            }
        }

        async function getPipelinesData() {
            try {
                const pipelinesRef = db.collection('pipelines');
                const snapshot = await pipelinesRef.get();
                return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error("Error al obtener datos de pipelines:", error);
                throw error;
            }
        }

        async function getPipelineById(id) {
            try {
                const doc = await db.collection('pipelines').doc(id).get();
                if (doc.exists) {
                    return { id: doc.id, ...doc.data() };
                } else {
                    throw new Error('Pipeline no encontrado');
                }
            } catch (error) {
                console.error("Error al obtener pipeline por ID:", error);
                throw error;
            }
        }

        // Funciones de interacci√≥n con la base de datos para empleados
        async function addEmployee(employeeData) {
            try {
                await db.collection('employees').add(employeeData);
            } catch (error) {
                console.error("Error al agregar empleado:", error);
                throw error;
            }
        }

        async function updateEmployee(employeeData) {
            try {
                await db.collection('employees').doc(employeeData.id).update(employeeData);
            } catch (error) {
                console.error("Error al actualizar empleado:", error);
                throw error;
            }
        }

        async function removeEmployee(id) {
            try {
                await db.collection('employees').doc(id).delete();
            } catch (error) {
                console.error("Error al eliminar empleado:", error);
                throw error;
            }
        }

        async function getEmployeesData() {
            try {
                const employeesRef = db.collection('employees');
                const snapshot = await employeesRef.get();
                return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error("Error al obtener datos de empleados:", error);
                throw error;
            }
        }

        async function getEmployeeById(id) {
            try {
                const doc = await db.collection('employees').doc(id).get();
                if (doc.exists) {
                    return { id: doc.id, ...doc.data() };
                } else {
                    throw new Error('Empleado no encontrado');
                }
            } catch (error) {
                console.error("Error al obtener empleado por ID:", error);
                throw error;
            }
        }

        // Funciones de interacci√≥n con la base de datos para etiquetas
        async function addTag(tagData) {
            try {
                await db.collection('tags').add(tagData);
            } catch (error) {
                console.error("Error al agregar etiqueta:", error);
                throw error;
            }
        }

        async function updateTag(tagData) {
            try {
                await db.collection('tags').doc(tagData.id).update(tagData);
            } catch (error) {
                console.error("Error al actualizar etiqueta:", error);
                throw error;
            }
        }

        async function removeTag(id) {
            try {
                await db.collection('tags').doc(id).delete();
            } catch (error) {
                console.error("Error al eliminar etiqueta:", error);
                throw error;
            }
        }

        async function getTagsData() {
            try {
                const tagsRef = db.collection('tags');
                const snapshot = await tagsRef.get();
                return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error("Error al obtener datos de etiquetas:", error);
                throw error;
            }
        }

        async function getTagById(id) {
            try {
                const doc = await db.collection('tags').doc(id).get();
                if (doc.exists) {
                    return { id: doc.id, ...doc.data() };
                } else {
                    throw new Error('Etiqueta no encontrada');
                }
            } catch (error) {
                console.error("Error al obtener etiqueta por ID:", error);
                throw error;
            }
        }

        // ... (resto del c√≥digo sin cambios)

    </script>
</body>
</html>

