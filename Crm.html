<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoCRM Pro v3</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #f0f0f0;
            --text-color: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .menu-icon {
            font-size: 24px;
            cursor: pointer;
        }

        .sidebar {
            position: fixed;
            left: -250px;
            top: 0;
            width: 250px;
            height: 100%;
            background-color: white;
            transition: 0.3s;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1001;
            overflow-y: auto;
            padding-top: 60px;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li a {
            display: block;
            padding: 15px;
            color: var(--text-color);
            text-decoration: none;
            border-bottom: 1px solid #eee;
        }

        .main-content {
            padding: 20px;
            margin-top: 60px;
        }

        .logout-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--primary-color);
            color: white;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                left: -100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <span class="menu-icon" onclick="toggleSidebar()">‚ò∞</span>
        <h1>AutoCRM Pro</h1>
    </div>

    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="#" onclick="showSection('dashboard')">üìä Dashboard</a></li>
            <li><a href="#" onclick="showSection('inventory')">üöó Inventario</a></li>
            <li><a href="#" onclick="showSection('clients')">üë• Clientes</a></li>
            <li><a href="#" onclick="showSection('sales')">üí∞ Ventas</a></li>
            <li><a href="#" onclick="showSection('services')">üîß Servicios</a></li>
            <li><a href="#" onclick="showSection('pipelines')">üìà Pipelines</a></li>
            <li><a href="#" onclick="showSection('employees')">üë®‚Äçüíº Empleados</a></li>
            <li><a href="#" onclick="showSection('tags')">üè∑Ô∏è Etiquetas</a></li>
        </ul>
        <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
    </div>

    <div class="main-content" id="main-content">
        <!-- El contenido principal se cargar√° aqu√≠ din√°micamente -->
    </div>

    <script>
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Funci√≥n para alternar la visibilidad del sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Funci√≥n para mostrar diferentes secciones
        function showSection(section) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `<h2>${section.charAt(0).toUpperCase() + section.slice(1)}</h2>`;
            
            switch(section) {
                case 'dashboard':
                    showDashboard();
                    break;
                case 'inventory':
                    showInventory();
                    break;
                case 'clients':
                    showClients();
                    break;
                case 'sales':
                    showSales();
                    break;
                case 'services':
                    showServices();
                    break;
                case 'pipelines':
                    showPipelines();
                    break;
                case 'employees':
                    showEmployees();
                    break;
                case 'tags':
                    showTags();
                    break;
            }

            toggleSidebar();
        }

        // Funci√≥n para mostrar el dashboard
        async function showDashboard() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML += `
                <div class="card">
                    <h3>Resumen de Ventas</h3>
                    <canvas id="salesChart"></canvas>
                </div>
                <div class="card">
                    <h3>Clientes Nuevos</h3>
                    <canvas id="clientsChart"></canvas>
                </div>
            `;

            try {
                const salesData = await getSalesData();
                const clientsData = await getClientsData();

                createChart('salesChart', 'Ventas Mensuales', salesData);
                createChart('clientsChart', 'Nuevos Clientes', clientsData);
            } catch (error) {
                console.error("Error al cargar datos del dashboard:", error);
                mainContent.innerHTML += `<p>Error al cargar los datos. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para crear gr√°ficos
        function createChart(canvasId, label, data) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Funci√≥n para mostrar el inventario
        async function showInventory() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML += `
                <div class="card">
                    <h3>Inventario de Veh√≠culos</h3>
                    <button class="btn" onclick="showAddVehicleForm()">Agregar Veh√≠culo</button>
                    <table id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Marca</th>
                                <th>Modelo</th>
                                <th>A√±o</th>
                                <th>Precio</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const inventory = await getInventoryData();
                const tableBody = document.querySelector('#inventoryTable tbody');
                tableBody.innerHTML = ''; // Limpiar la tabla antes de agregar nuevos datos
                inventory.forEach(car => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${car.brand}</td>
                        <td>${car.model}</td>
                        <td>${car.year}</td>
                        <td>$${car.price.toLocaleString()}</td>
                        <td>
                            <button onclick="editVehicle('${car.id}')">Editar</button>
                            <button onclick="deleteVehicle('${car.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar el inventario:", error);
                mainContent.innerHTML += `<p>Error al cargar el inventario. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para mostrar el formulario de agregar veh√≠culo
        function showAddVehicleForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Agregar Veh√≠culo</h3>
                    <form id="addVehicleForm">
                        <div class="form-group">
                            <label for="brand">Marca:</label>
                            <input type="text" id="brand" required>
                        </div>
                        <div class="form-group">
                            <label for="model">Modelo:</label>
                            <input type="text" id="model" required>
                        </div>
                        <div class="form-group">
                            <label for="year">A√±o:</label>
                            <input type="number" id="year" required>
                        </div>
                        <div class="form-group">
                            <label for="price">Precio:</label>
                            <input type="number" id="price" required>
                        </div>
                        <button type="submit" class="btn">Agregar Veh√≠culo</button>
                    </form>
                </div>
            `;

            document.getElementById('addVehicleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const vehicleData = {
                    brand: document.getElementById('brand').value,
                    model: document.getElementById('model').value,
                    year: parseInt(document.getElementById('year').value),
                    price: parseFloat(document.getElementById('price').value)
                };
                try {
                    await addVehicle(vehicleData);
                    alert('Veh√≠culo agregado con √©xito');
                    showInventory();
                } catch (error) {
                    console.error("Error al agregar veh√≠culo:", error);
                    alert('Error al agregar veh√≠culo. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funciones para obtener datos (simuladas para este ejemplo)
        async function getSalesData() {
            // Simular obtenci√≥n de datos de ventas
            return [10000, 15000, 13000, 17000, 20000, 18000];
        }

        async function getClientsData() {
            // Simular obtenci√≥n de datos de clientes
            return [5, 7, 3, 8, 4, 6];
        }

        async function getInventoryData() {
            // Simular obtenci√≥n de datos de inventario
            return [
                { id: '1', brand: 'Toyota', model: 'Corolla', year: 2022, price: 25000 },
                { id: '2', brand: 'Honda', model: 'Civic', year: 2021, price: 23000 },
                { id: '3', brand: 'Ford', model: 'Mustang', year: 2023, price: 45000 }
            ];
        }

        // Funciones CRUD para veh√≠culos (simuladas)
        async function addVehicle(vehicleData) {
            // Simular agregar veh√≠culo a la base de datos
            console.log("Veh√≠culo agregado:", vehicleData);
        }

        async function editVehicle(id) {
            // Implementar l√≥gica para editar veh√≠culo
            console.log("Editando veh√≠culo con ID:", id);
        }

        async function deleteVehicle(id) {
            // Implementar l√≥gica para eliminar veh√≠culo
            console.log("Eliminando veh√≠culo con ID:", id);
        }

        // Funci√≥n para cerrar sesi√≥n
        function logout() {
            firebase.auth().signOut().then(() => {
                alert('Has cerrado sesi√≥n correctamente');
                showLoginForm();
            }).catch((error) => {
                console.error('Error al cerrar sesi√≥n:', error);
                alert('Error al cerrar sesi√≥n. Por favor, int√©ntelo de nuevo.');
            });
        }

        // Funci√≥n para mostrar el formulario de inicio de sesi√≥n
        function showLoginForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h2>Iniciar Sesi√≥n</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Contrase√±a:</label>
                            <input type="password" id="password" required>
                        </div>
                        <button type="submit" class="btn">Iniciar Sesi√≥n</button>
                    </form>
                </div>
            `;

            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                try {
                    await firebase.auth().signInWithEmailAndPassword(email, password);
                    showDashboard();
                } catch (error) {
                    console.error("Error de autenticaci√≥n:", error);
                    alert('Error al iniciar sesi√≥n. Verifique sus credenciales.');
                }
            });
        }

        // Funci√≥n para mostrar clientes
        async function showClients() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Clientes</h3>
                    <button class="btn" onclick="showAddClientForm()">Agregar Cliente</button>
                    <table id="clientsTable">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Tel√©fono</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const clients = await getClientsData();
                const tableBody = document.querySelector('#clientsTable tbody');
                tableBody.innerHTML = '';
                clients.forEach(client => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${client.name}</td>
                        <td>${client.email}</td>
                        <td>${client.phone}</td>
                        <td>
                            <button onclick="editClient('${client.id}')">Editar</button>
                            <button onclick="deleteClient('${client.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar clientes:", error);
                mainContent.innerHTML += `<p>Error al cargar los clientes. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para mostrar el formulario de agregar cliente
        function showAddClientForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Agregar Cliente</h3>
                    <form id="addClientForm">
                        <div class="form-group">
                            <label for="name">Nombre:</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Tel√©fono:</label>
                            <input type="tel" id="phone" required>
                        </div>
                        <button type="submit" class="btn">Agregar Cliente</button>
                    </form>
                </div>
            `;

            document.getElementById('addClientForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const clientData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                };
                try {
                    await addClient(clientData);
                    alert('Cliente agregado con √©xito');
                    showClients();
                } catch (error) {
                    console.error("Error al agregar cliente:", error);
                    alert('Error al agregar cliente. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funciones CRUD para clientes (simuladas)
        async function addClient(clientData) {
            // Simular agregar cliente a la base de datos
            console.log("Cliente agregado:", clientData);
        }

        async function editClient(id) {
            // Implementar l√≥gica para editar cliente
            console.log("Editando cliente con ID:", id);
        }

        async function deleteClient(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar este cliente?')) {
                // Implementar l√≥gica para eliminar cliente
                console.log("Eliminando cliente con ID:", id);
            }
        }

        // Funci√≥n para mostrar ventas
        async function showSales() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Ventas</h3>
                    <button class="btn" onclick="showAddSaleForm()">Registrar Venta</button>
                    <table id="salesTable">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Cliente</th>
                                <th>Veh√≠culo</th>
                                <th>Monto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            `;

            try {
                const sales = await getSalesDetailedData();
                const tableBody = document.querySelector('#salesTable tbody');
                tableBody.innerHTML = '';
                sales.forEach(sale => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${new Date(sale.date).toLocaleDateString()}</td>
                        <td>${sale.clientName}</td>
                        <td>${sale.vehicleName}</td>
                        <td>$${sale.amount.toLocaleString()}</td>
                        <td>
                            <button onclick="editSale('${sale.id}')">Editar</button>
                            <button onclick="deleteSale('${sale.id}')">Eliminar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar ventas:", error);
                mainContent.innerHTML += `<p>Error al cargar las ventas. Por favor, int√©ntelo de nuevo m√°s tarde.</p>`;
            }
        }

        // Funci√≥n para mostrar el formulario de agregar venta
        function showAddSaleForm() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="card">
                    <h3>Registrar Nueva Venta</h3>
                    <form id="addSaleForm">
                        <div class="form-group">
                            <label for="clientId">Cliente:</label>
                            <select id="clientId" required>
                                <option value="">Seleccione un cliente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleId">Veh√≠culo:</label>
                            <select id="vehicleId" required>
                                <option value="">Seleccione un veh√≠culo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">Monto:</label>
                            <input type="number" id="amount" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="date">Fecha:</label>
                            <input type="date" id="date" required>
                        </div>
                        <button type="submit" class="btn">Registrar Venta</button>
                    </form>
                </div>
            `;

            loadClientsIntoSelect();
            loadVehiclesIntoSelect();

            document.getElementById('addSaleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const saleData = {
                    clientId: document.getElementById('clientId').value,
                    vehicleId: document.getElementById('vehicleId').value,
                    amount: parseFloat(document.getElementById('amount').value),
                    date: document.getElementById('date').value
                };
                try {
                    await addSale(saleData);
                    alert('Venta registrada con √©xito');
                    showSales();
                } catch (error) {
                    console.error("Error al registrar venta:", error);
                    alert('Error al registrar la venta. Por favor, int√©ntelo de nuevo.');
                }
            });
        }

        // Funciones auxiliares para cargar datos en selectores
        async function loadClientsIntoSelect() {
            try {
                const clients = await getClientsData();
                const select = document.getElementById('clientId');
                select.innerHTML = '<option value="">Seleccione un cliente</option>';
                clients.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id;
                    option.textContent = client.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error("Error al cargar clientes:", error);
                alert('Error al cargar la lista de clientes. Por favor, recargue la p√°gina.');
            }
        }

        async function loadVehiclesIntoSelect() {
            try {
                const vehicles = await getInventoryData();
                const select = document.getElementById('vehicleId');
                select.innerHTML = '<option value="">Seleccione un veh√≠culo</option>';
                vehicles.forEach(vehicle => {
                    const option = document.createElement('option');
                    option.value = vehicle.id;
                    option.textContent = `${vehicle.brand} ${vehicle.model} (${vehicle.year})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error("Error al cargar veh√≠culos:", error);
                alert('Error al cargar la lista de veh√≠culos. Por favor, recargue la p√°gina.');
            }
        }

        // Funciones CRUD para ventas (simuladas)
        async function addSale(saleData) {
            // Simular agregar venta a la base de datos
            console.log("Venta agregada:", saleData);
        }

        async function editSale(id) {
            // Implementar l√≥gica para editar venta
            console.log("Editando venta con ID:", id);
        }

        async function deleteSale(id) {
            if (confirm('¬øEst√° seguro de que desea eliminar esta venta?')) {
                // Implementar l√≥gica para eliminar venta
                console.log("Eliminando venta con ID:", id);
            }
        }

        // Funci√≥n para obtener datos detallados de ventas (simulada)
        async function getSalesDetailedData() {
            // Simular obtenci√≥n de datos detallados de ventas
            return [
                { id: '1', date: '2023-08-01', clientName: 'Juan P√©rez', vehicleName: 'Toyota Corolla', amount: 25000 },
                { id: '2', date: '2023-08-15', clientName: 'Mar√≠a Garc√≠a', vehicleName: 'Honda Civic', amount: 23000 }
            ];
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    showDashboard();
                } else {
                    showLoginForm();
                }
            });
        });

        // Manejo de errores global
        window.onerror = function(message, source, lineno, colno, error) {
            console.error("Error no capturado:", error);
            alert("Ha ocurrido un error inesperado. Por favor, recargue la p√°gina e int√©ntelo de nuevo.");
            return true;
        };

    </script>
</body>
</html>
